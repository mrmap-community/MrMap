# Generated by Django 5.0 on 2023-12-18 11:57

import pgtrigger.compiler
import pgtrigger.migrations
from django.db import migrations


class Migration(migrations.Migration):

    dependencies = [
        ('registry', '0003_remove_datasetmetadatarecordkeywords_sync_keywords_list_and_more'),
    ]

    operations = [
        pgtrigger.migrations.RemoveTrigger(
            model_name='datasetmetadatarecordkeywords',
            name='sync_keywords_list',
        ),
        pgtrigger.migrations.AddTrigger(
            model_name='datasetmetadatarecordkeywords',
            trigger=pgtrigger.compiler.Trigger(name='sync_keywords_list', sql=pgtrigger.compiler.UpsertTriggerSql(func='\n                    UPDATE registry_datasetmetadatarecord\n                    SET keywords_list = array(\n                        SELECT keyword \n                        FROM registry_keyword \n                        WHERE keyword_id IN (\n                            SELECT keyword_id\n                            FROM registry_datasetmetadatarecordkeywords\n                            WHERE dataset_id = NEW.dataset_id\n                        )\n                    )\n                    WHERE id = NEW.dataset_id;\n                    RETURN NULL;\n                ', hash='27910fb85699af4ba74586960c66accdc33e8ba1', operation='UPDATE OR DELETE OR INSERT', pgid='pgtrigger_sync_keywords_list_44e2d', table='registry_datasetmetadatarecordkeywords', when='AFTER')),
        ),
    ]
