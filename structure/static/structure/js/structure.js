function sendPublishRequest(organizationId, entity){
    $.ajax({
        url: rootUrl + "/" + entity + "/organizations/publish-request/" + organizationId,
        headers: {
            "X-CSRFToken": getCookie("csrftoken")
        },
        data: {},
        type: 'get',
        dataType: 'json'
    }).done(function(data){
        var html = data["html"];
        toggleOverlay(html);
    }).always(function(data){
        checkRedirect(data);
    });
}

function filterOrgsByCheckbox(){
    var elem = $("#checkbox-real-orgs");
    var isChecked = elem.is(":checked");
    var orgs = $(".org");
    orgs.each(function(i, org){
        org = $(org);
        var autoGenerated = org.find("[data-type='auto-gen']").attr("data-toggle") == 'True';
        if(isChecked && autoGenerated){
            org.hide();
        }else{
            org.show();
        }
    });
}

/**
*  JQuery content goes here!
*/
$(document).ready(function(){

    filterOrgsByCheckbox();

    $(".collapsible-title").click(function(){
        var elem = $(this);
        var elements = elem.siblings(".subelements");
        elements.toggle("slow");
        var img = elem.find("img");
        toggleCollapsibleSymbol(img);
    });

    /**
    * Get request form for becoming a publisher to this organization
    */
    $("#request-publish-button").click(function(){
        var elem = $(this);
        var organizationId = elem.attr("datasrc");
        var entity = elem.attr("typeof")
        sendPublishRequest(organizationId, entity);
    });

    $("#checkbox-real-orgs").on("change", function(){
        filterOrgsByCheckbox();
        $(".search-field").trigger("input");
    });

    $(".search-field").on("input", function(){
        var elem = $(this);
        var input = elem.val().toUpperCase();
        var orgs = $(".org");
        var onlyRealOrgs = $("#checkbox-real-orgs").is(":checked");
        orgs.each(function(i, org){
            org = $(org);
            var name = org.find("[data-type='name']").text().trim().toUpperCase();
            var descr = org.find("[data-type='descr']").text().trim().toUpperCase();
            var isRealOrg = org.find("[data-type='auto-gen']").attr("data-toggle") == 'False';
            if((name.includes(input) || descr.includes(input))){
                if(onlyRealOrgs && isRealOrg){
                    org.show();
                }else if(!onlyRealOrgs){
                    org.show();
                }
            }else{
                org.hide();
            }
        });
    });

});
