{% load i18n static %}

<style>

.field-label, .field{
    font-size: 1.2em;
}

.field input, .field textarea, .field select{
    color: gray;
    background-color: white;
    border: 1px solid gray;
    border-radius: 0.25rem;
    padding: 0.375rem 0.75rem;
}

.field input:focus{
    -webkit-box-shadow: 0 0 10px var(--primary-color);
    -moz-box-shadow: 0 0 10px var(--primary-color);
    box-shadow: 0 0 10px var(--primary-color);
}

.form-submit-area{
    display: flex;
    justify-content: space-between;
    padding: 20px 0;
}
.modal-content{
    max-height: 75vh;
    overflow-y: auto;
}

.field{
    position: relative;
}

article{
    padding: 10px 0 10px 0;
}

#password_message {
  display:none;
  background: #f1f1f1;
  color: #000;
  position: relative;
  padding:   20px;
  margin-top: 10px;
}


.valid {
  color: var(--secondary-color);
}

.valid:before {
  position: relative;
  content: "✔ ";
}

/* Add a red text color and an "x" when the requirements are wrong */
.invalid {
  color: red;
}

.invalid:before {
  position: relative;
  content: "✖ ";
}


</style>

{% block body %}
<div class="modal-dialog">
    <div class="modal-close" title="{% trans 'Close' %}">
        x
    </div>
    <div class="modal-content">
        <article>
            {{ article }}
        </article>
        <hr>
        <form action="{{ action_url }}" method="post" >
            {% csrf_token %}
            <table class="form-table">
                {% for field in form %}
                    <tr>
                        <td class="field-label">{% trans field.label %}</td>
                        <td class="field">{{ field }}</td>
                    </tr>
                {% endfor %}
            </table>
            <div id="password_message">
                <h3>{% trans 'Password must contain the following:' %}</h3>
                <p id="letter" class="invalid"><b>{% trans 'Lowercase letters' %}</b> </p>
                <p id="capital" class="invalid"><b>{% trans 'Uppercase letters' %}</b> </p>
                <p id="number" class="invalid"><b>{% trans 'At least one Number' %}</b></p>
                <p id="length" class="invalid"><b>{% trans 'At least 9 characters' %}</b></p>
            </div>
            <input class="submit-button button" id="submit-text" type="submit" value="{% trans 'Save' %}"/>
        </form>
    </div>
</div>

<script>

    $(".modal-close, .close-button").click(function(){
        toggleOverlay("");
    });

    // Password message popup
    $(document).on('focus', "#id_password", function(){
        $("#password_message").fadeIn("slow");
    });

    // Client side password validation
    $(document).on('keyup', "#id_password", function(){

      var PasswordInput = document.getElementById("id_password");
      var letter = document.getElementById("letter");
      var capital = document.getElementById("capital");
      var number = document.getElementById("number");
      var length = document.getElementById("length");

      // Validate lowercase letters
      if(PasswordInput.value.match(/[a-z]/g)) {
        letter.classList.remove("invalid");
        letter.classList.add("valid");
      } else {
        letter.classList.remove("valid");
        letter.classList.add("invalid");
      }

      // Validate capital letters
      if(PasswordInput.value.match(/[A-Z]/g)) {
        capital.classList.remove("invalid");
        capital.classList.add("valid");
      } else {
        capital.classList.remove("valid");
        capital.classList.add("invalid");
      }

      // Validate numbers
      if(PasswordInput.value.match(/[0-9]/g)) {
        number.classList.remove("invalid");
        number.classList.add("valid");
      } else {
        number.classList.remove("valid");
        number.classList.add("invalid");
      }

      // Validate length
      if(PasswordInput.value.length >= 9) {
        length.classList.remove("invalid");
        length.classList.add("valid");
      } else {
        length.classList.remove("valid");
        length.classList.add("invalid");
      }

    });

    // focus directly on input field
    $("#id_password").focus();

</script>

{% endblock %}