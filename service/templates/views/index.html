{% extends 'base.html' %}
{% load i18n static tz %}

{% block head %}
    <script type="text/javascript" src="{% static '/service/js/service.js' %}"></script>
    <script type="text/javascript" src="{% static '/service/js/pending_tasks.js' %}"></script>
{% endblock %}

{% block body %}
<div class="container">
    {% if pt_table.rows %}
        <div id="id_pending_tasks_div">
            {% include 'includes/pending_tasks.html' %}
        </div>
        <script type="text/javascript">
            interval = setInterval(function(){
                $.get( '{% url 'service:pending-tasks' %}', function( data ) {

                    $( "#id_pending_tasks_div" ).html( data );
                });
                // stop interval if table is empty and delete the pt_table
                if( $("#id_pt_empty").length ) {
                    clearInterval(interval);
                    setTimeout(function() {
                        $("#id_pending_tasks_div").remove();
                    }, 1000);
                };
            }, 1000);
        </script>
    {% endif %}

    {% if only_type == 'wms' or only_type is None %}
        {% include 'includes/index/wms.html' %}
    {% endif %}

    {% if only_type == 'wfs' or only_type is None %}
        {% include 'includes/index/wfs.html' %}
    {% endif %}

    {% if 'can_register_service' in user_permissions %}
        {% with form=new_service_form %}
            {% with 'new_service' as id_modal %}
                {% include 'modals/new_service.html' %}
            {% endwith %}
        {% endwith %}
    {% endif %}

</div>
{% endblock %}