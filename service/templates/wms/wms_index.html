{% load i18n static tz %}

<div class="overview-title-actions-container">
    <div class="container-left">
        <h2>{% trans 'WMS' %}</h2>
        {% if 'can_register_service' in user_permissions %}
        <div class="overview-action">
            <span class="add-button" title="{% trans 'Register new' %}" datatype="wms" typeof="service">
                &#xFF0B;
            </span>
        </div>
        {% endif %}
    </div>
    <div class="container-right">
    </div>
</div>
{% if metadata_list_wms|length > 0 %}
<div>
    <div>
        <label for="rpp-select-wms">{% trans 'Results per page' %}:</label>
        <select id="rpp-select-wms" class="rpp-select default-select" title="{% trans 'Results per page' %}:">
            {% for option in rpp_select_options %}
            <option value="{{ option }}" {% if option == rpp %}selected="selected"{% endif %}>{{ option }}</option>
            {% endfor %}
        </select>
    </div>
</div>
<div class="filter-container">
    <div class="container-left">
        <input class="search-field" type="text" name="text-filter" data-type="wms" placeholder="{% trans 'Enter text to filter' %}">
    </div>
    <div class="container-center">
        {% if metadata_list_wms.paginator.num_pages > 1 %}
        <div>
            <div class="pagination-wrapper">
                {% if metadata_list_wms.number != 1 %}
                <a class="pagination-page" href="?wmsp=1&wfsp={{ metadata_list_wfs.number }}&rpp={{ rpp }}" title="{% trans 'First page' %}">
                    1
                </a>
                <span>...</span>
                {% endif %}
                <input class="pagination-input" data-type="wmsp" type="number" min="1" value="{{ metadata_list_wms.number }}" title="{% trans 'Enter page number' %}">
                {% if metadata_list_wms.number != metadata_list_wms.paginator.num_pages %}
                <span>...</span>
                <a class="pagination-page" href="?wmsp={{ metadata_list_wms.paginator.num_pages }}&wfsp={{ metadata_list_wfs.number }}&rpp={{ rpp }}" title="{% trans 'Last page' %}">
                    {{ metadata_list_wms.paginator.num_pages }}
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
    <div class="container-right">
        <select id="service-display-selector" class="default-select" title="Group elements">
            <option value="s" {% if select_default == 's' %} selected {% endif %}>{% trans 'Show services' %}</option>
            <option value="l" {% if select_default == 'l' %} selected {% endif %}>{% trans 'Show layers' %}</option>
        </select>
    </div>
</div>
<table class="overview-table">
    <tr>
        <th class="table-header">
            {% trans 'Title' %}
        </th>
        {% if select_default == 'layers' %}
        <th class="table-header">
            {% trans 'Parent service' %}
        </th>
        {% else %}
        <th class="table-header">
            {% trans 'Layers' %}
        </th>
        {% endif %}
        <th class="table-header">
            {% trans 'Active' %}
        </th>
        <th class="table-header">
            {% trans 'Secured access' %}
        </th>
        <th class="table-header">
            {% trans 'Secured externally' %}
        </th>
        <th class="table-header">
            {% trans 'Version' %}
        </th>
        <th class="table-header">
            {% trans 'Data provider' %}
        </th>
        <th class="table-header">
            {% trans 'Registered by group' %}
        </th>
        <th class="table-header">
            {% trans 'Registered for' %}
        </th>
        <th class="table-header">
            {% trans 'Created' %}
        </th>
    </tr>
    {% for md in metadata_list_wms %}
    <tr class="service" data-type="wms">
        <td class="table-cell" data-type="title">
            <a href="{% url 'service:detail' id=md.id %}" title="{% trans 'Open details' %}">{{ md.title }}</a>
        </td>
        {% if select_default == 'layers' %}
        <td class="table-cell" data-type="parent-service">
            <a href="{% url 'service:detail' id=md.service.parent_service.metadata.id %}" title="{% trans 'Open details' %}">{{ md.service.parent_service.metadata.title }}</a>
        </td>
        {% else %}
        <td class="table-cell center">
            {{ md.service.child_service.all|length }}
        </td>
        {% endif %}
        <td class="table-cell center">
            {% if md.is_active %}
            <img src="{% static 'service/images/icn_true.png' %}" title="{% trans 'Active' %}">
            {% else %}
            <img src="{% static 'service/images/icn_false.png' %}" title="{% trans 'Not active' %}">
            {% endif %}
        </td>
        <td class="table-cell center">
            {% if md.is_secured %}
            <img src="{% static 'service/images/icn_true.png' %}" title="{% trans 'Access secured' %}">
            {% else %}
            <img src="{% static 'service/images/icn_false.png' %}" title="{% trans 'Access not restricted' %}">
            {% endif %}
        </td>
        <td class="table-cell center">
            {% if md.has_external_authentication %}
            <img src="{% static 'service/images/icn_true.png' %}" title="{% trans 'Secured externally' %}">
            {% else %}
            <img src="{% static 'service/images/icn_false.png' %}" title="{% trans 'No external security' %}">
            {% endif %}
        </td>
        <td class="table-cell center">
            {{ md.service.servicetype.version }}
        </td>
        <td class="table-cell" title="{{ md.contact.organization_name }}">
            <a href="{% url 'structure:detail-organization' md.contact.id %}">{{ md.contact.organization_name }}</a>
        </td>
        <td class="table-cell">
            <a href="{% url 'structure:detail-group' md.service.created_by.id %}">{{ md.service.created_by }}</a>
        </td>
        <td class="table-cell">
            {% if md.service.published_for is not None %}
            <a href="{% url 'structure:detail-organization' md.service.published_for.id %}">{{ md.service.published_for }}</a>
            {% else %}
            {{ md.service.published_for }}
            {% endif %}
        </td>
        <td class="table-cell">
            {{ md.created | localtime }}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
{% trans 'None ¯\_(ツ)_/¯' %}
{% endif %}