name: Publishing docs on github pages
on:
  workflow_dispatch:
  push:
    branches: [master]

jobs:
  check-docs:
    name: build docs
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - name: Install System Dependencies for MrMap project
        run: |
          sudo apt-get update && sudo apt-get install -y --no-install-recommends \
          libssl-dev \
          libcurl4-openssl-dev \
          gdal-bin \
          postgresql \
          postgresql-client \
          postgis \
          postgresql-server-dev-13 \
          postgresql-13-postgis-3 \
          postgresql-13-postgis-3-scripts \
          redis-server
      - name: Install dependencies of MrMap application
        run: |
          pip3 install -r ./mrmap/requirements.txt
      - name: Install dependencies of documentation
        run: |
          pip3 install -r ./docs/requirements.txt
      - name: publish docs
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: "docs/publish_docs.sh"
        shell: bash
