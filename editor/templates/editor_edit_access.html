{% extends 'base.html' %}
{% load i18n static %}

{% block head %}
    <script type="text/javascript" src="{% static '/editor/js/editor.js' %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static '/editor/css/editor.css' %}" media="all" />
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"
      integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og=="
      crossorigin=""></script>
<!--
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" />
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
-->
{% endblock %}

{% block body %}
<div class="back-links">
    <a href="{% url 'editor:index' %}">
        <h3 class="back-title">
            <img src="{% static 'service/images/icn_back.png' %}">
            {% trans 'Overview' %}
        </h3>
    </a>
    <a href="{% url 'service:detail' service_metadata.id %}">
        <h3 class="back-title">
            <img src="{% static 'service/images/icn_back.png' %}">
            {% trans 'Service Detail View' %}
        </h3>
    </a>
</div>
<hr>
<div class="container-row space-above">
    <div class="container-left">
    </div>
    <div class="container-right">
    </div>
</div>

<h1>{% trans 'Access Editor' %}</h1>
<h2>
    {% if service_metadata.is_root %}
        {% trans 'Service:' %}
    {% elif service_metadata.metadata_type.type == 'featuretype' %}
        {% trans 'Featuretype:' %}
    {% elif service_metadata.metadata_type.type == 'layer' %}
        {% trans 'Layer:' %}
    {% endif %}
    {{ service_metadata.title }}
</h2>

<form id="metadata-form" action="{{ action_url }}" method="post" >
    {% csrf_token %}
    <table class="form-table">
        <tr class="field-label metadata-editor-label">
            <td>{% trans 'Restrict access:' %}</td>
            <td><input id="checkbox-restrict-access" type="checkbox" name="is_secured" {% if service_metadata.is_secured %}checked{% endif %} title="{% trans 'Restrict access' %}"></td>
        </tr>
        {% for operation in operations %}
        <tr class="operation-row">
            <td class="field-label metadata-editor-label">
                {{ operation.operation.operation_name }}:
            </td>
            <td class="secured-operation-group-view">
                <input class="search-field" type="text" data-type="{{ operation.operation.id }}" placeholder="{% trans 'Enter text to filter' %}">
                <ul class="no-bullet" data-operation="{{ operation.operation.operation_name }}">
                {% for group in operation.groups %}
                    <li class="{{ operation.operation.id }} secured-group-operation">
                        <input id="checkbox-sec-{{ group.group.id }}-{{ operation.operation.id }}"
                               class="group-permission"
                               {% if group.allowed %}checked{% endif %}
                               type="checkbox"
                               title="{{ group.group.name }}"
                               data-operation="{{ operation.operation.operation_name }}"
                               data-group="{{ group.group.id }}"
                               data-remove="false"
                               data-polygons='{{ group.geo_json_geometry|safe }}'
                               data-sec-id="{{ group.sec_id }}">
                        <label for="checkbox-sec-{{ group.group.id }}-{{ operation.operation.id }}">{{ group.group.name }} ({{ group.group.organization.organization_name }})</label>
                        {% if operation.operation.operation_name in spatial_restrictable_operations %}
                        <span class="add-geometry fas fa-pen" data-id="{{ service_metadata.id }}" title="{% trans 'Add restricting geometry' %}">
                        </span>
                        {% endif %}
                        <span class="{% if group.geo_json_geometry is None %}hide{% endif %} listable geometry-indicator" title="{% trans 'Has restricting geometry' %}">
                            <span class="fas fa-draw-polygon"></span>
                        </span>
                    </li>
                {% endfor %}
                </ul>
            </tr>
        </tr>
        {% endfor %}
    </table>
    <input name="secured-operation-groups" type="text" class="hidden">
    <input class="submit-button button secured-operations" id="submit-text" type="submit" value="{% trans 'Save' %}"/>
</form>

{% endblock %}